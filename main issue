
import streamlit as st
import math
from itertools import product

class WBGelCalculator:
    def __init__(self):
        # å¸‚å”®èƒ¶æµ“åº¦ï¼ˆæ˜¾ç¤ºå€¼ï¼Œå®é™…æµ“åº¦æ˜¯2å€ï¼‰
        self.standard_concentrations = [4.5, 5.0, 6.0, 7.5, 8.0, 10.0, 12.5, 15.0]
        
    def setup_ui(self):
        st.title("ğŸ§ª WBèƒ¶æµ“åº¦ç¨€é‡Šè®¡ç®—å™¨")
        
        # æ·»åŠ è¯´æ˜
        with st.expander("ğŸ“– ä½¿ç”¨è¯´æ˜", expanded=True):
            st.markdown("""
            **ä½¿ç”¨æ–¹æ³•ï¼š**
            1. **é€‰æ‹©èƒ¶æµ“åº¦** - å‹¾é€‰éœ€è¦ä½¿ç”¨çš„èƒ¶æµ“åº¦ï¼ˆå¯å¤šé€‰ï¼Œæ‰€æœ‰é€‰ä¸­çš„èƒ¶éƒ½å¿…é¡»ä½¿ç”¨ï¼‰
            2. **è®¾ç½®å‚æ•°** - è¾“å…¥ç›®æ ‡æ€»ä½“ç§¯å’Œç›®æ ‡èƒ¶æµ“åº¦
            3. **è®¡ç®—** - ç‚¹å‡»è®¡ç®—æŒ‰é’®è·å–æœ€ä¼˜é…æ¯”æ–¹æ¡ˆ
            
            **æ³¨æ„äº‹é¡¹ï¼š**
            - å¸‚å”®èƒ¶çš„**å®é™…æµ“åº¦ä¸ºæ˜¾ç¤ºå€¼çš„2å€**ï¼ˆå¦‚5%èƒ¶å®é™…æµ“åº¦ä¸º10%ï¼‰
            - è®¡ç®—ç»“æœä¼šæ˜¾ç¤ºå‰10ç»„æœ€ä¼˜è§£ï¼Œ**æ•´æ•°è§£ä¼˜å…ˆ**
            - ç¼“å†²æ¶²æ¯”ä¾‹é€‚ä¸­çš„æ–¹æ¡ˆè¯„åˆ†æ›´é«˜
            """)
        
        st.divider()
        
        # èƒ¶æµ“åº¦é€‰æ‹©
        st.subheader("1ï¸âƒ£ é€‰æ‹©èƒ¶æµ“åº¦")
        st.caption("æ‰€æœ‰é€‰ä¸­çš„èƒ¶éƒ½å¿…é¡»ä½¿ç”¨ï¼Œå®é™…æµ“åº¦ä¸ºæ˜¾ç¤ºå€¼çš„2å€")
        
        # ä½¿ç”¨åˆ—å¸ƒå±€æ˜¾ç¤ºå¤é€‰æ¡†
        cols = st.columns(4)
        self.selected_gels = []
        
        for i, conc in enumerate(self.standard_concentrations):
            col_idx = i % 4
            with cols[col_idx]:
                if st.checkbox(f"{conc}%", key=f"gel_{conc}", help=f"å®é™…æµ“åº¦: {conc*2}%"):
                    self.selected_gels.append(conc)
        
        st.divider()
        
        # ç›®æ ‡å‚æ•°
        st.subheader("2ï¸âƒ£ è®¾ç½®ç›®æ ‡å‚æ•°")
        col1, col2 = st.columns(2)
        
        with col1:
            total_volume = st.number_input(
                "**ç›®æ ‡æ€»ä½“ç§¯ (ml)**",
                min_value=0.1,
                max_value=1000.0,
                value=10.0,
                step=0.1,
                format="%.1f",
                help="æœ€ç»ˆé…åˆ¶çš„èƒ¶æº¶æ¶²æ€»ä½“ç§¯"
            )
        
        with col2:
            target_concentration = st.number_input(
                "**ç›®æ ‡èƒ¶æµ“åº¦ (%)**",
                min_value=0.1,
                max_value=30.0,
                value=8.0,
                step=0.1,
                format="%.1f",
                help="éœ€è¦é…åˆ¶çš„èƒ¶æµ“åº¦"
            )
        
        st.divider()
        
        # è®¡ç®—æŒ‰é’®
        st.subheader("3ï¸âƒ£ è®¡ç®—ç»“æœ")
        
        # æ˜¾ç¤ºé€‰ä¸­çš„èƒ¶å’Œå‚æ•°
        if self.selected_gels:
            selected_str = "ã€".join([f"{g}%" for g in self.selected_gels])
            st.info(f"âœ… å·²é€‰æ‹©: {selected_str} | ç›®æ ‡ä½“ç§¯: {total_volume}ml | ç›®æ ‡æµ“åº¦: {target_concentration}%")
        
        if st.button("ğŸš€ å¼€å§‹è®¡ç®—", type="primary", use_container_width=True):
            if not self.selected_gels:
                st.error("âŒ è¯·è‡³å°‘é€‰æ‹©ä¸€ç§èƒ¶æµ“åº¦ï¼")
            elif total_volume <= 0:
                st.error("âŒ ç›®æ ‡æ€»ä½“ç§¯å¿…é¡»å¤§äº0ï¼")
            elif target_concentration <= 0:
                st.error("âŒ ç›®æ ‡èƒ¶æµ“åº¦å¿…é¡»å¤§äº0ï¼")
            else:
                with st.spinner("æ­£åœ¨è®¡ç®—æœ€ä½³é…æ¯”æ–¹æ¡ˆ..."):
                    solutions = self.calculate_solutions(
                        self.selected_gels, 
                        target_concentration, 
                        total_volume
                    )
                    
                    # æ˜¾ç¤ºè¿›åº¦æ¡
                    progress_bar = st.progress(0)
                    
                    # æ¨¡æ‹Ÿè®¡ç®—è¿‡ç¨‹ï¼ˆå®é™…è®¡ç®—å·²åœ¨å‡½æ•°ä¸­å®Œæˆï¼‰
                    for i in range(100):
                        # è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿè¿›åº¦
                        import time
                        time.sleep(0.01)
                        progress_bar.progress(i + 1)
                    
                    progress_bar.empty()
                    
                    # æ˜¾ç¤ºç»“æœ
                    self.display_results(solutions, self.selected_gels, total_volume, target_concentration)
    
    def calculate_solutions(self, selected_gels, target_conc, total_volume):
        """è®¡ç®—æ‰€æœ‰å¯èƒ½çš„é…æ¯”æ–¹æ¡ˆ"""
        solutions = []
        n_gels = len(selected_gels)
        
        # è®¡ç®—ç›®æ ‡æ€»èƒ¶è´¨é‡ï¼ˆæ³¨æ„ï¼šèƒ¶æµ“åº¦éœ€è¦ä¹˜ä»¥2å¾—åˆ°å®é™…æµ“åº¦ï¼‰
        target_gel_mass = target_conc * total_volume
        
        # å®é™…èƒ¶æµ“åº¦ï¼ˆ2å€æ˜¾ç¤ºå€¼ï¼‰
        actual_gel_concentrations = [conc * 2 for conc in selected_gels]
        
        # åˆ›å»ºçŠ¶æ€å®¹å™¨æ˜¾ç¤ºå½“å‰è®¡ç®—çŠ¶æ€
        status_text = st.empty()
        
        if n_gels == 1:
            # å•ä¸€èƒ¶æµ“åº¦ - ç²¾ç¡®è§£
            status_text.text("ğŸ” è®¡ç®—å•ä¸€èƒ¶æµ“åº¦æ–¹æ¡ˆ...")
            c_actual = actual_gel_concentrations[0]
            v_gel = target_gel_mass / c_actual
            buffer_vol = total_volume - v_gel
            
            if v_gel > 0 and buffer_vol >= 0:
                solutions.append({
                    'volumes': [v_gel],
                    'buffer_volume': buffer_vol,
                    'actual_conc': target_conc,
                    'score': self.calculate_score([v_gel], buffer_vol, total_volume)
                })
            
        elif n_gels == 2:
            # ä¸¤ä¸ªèƒ¶æµ“åº¦ - çº¿æ€§æ–¹ç¨‹
            status_text.text("ğŸ” è®¡ç®—ä¸¤ç§èƒ¶æ··åˆæ–¹æ¡ˆ...")
            c1_actual, c2_actual = actual_gel_concentrations
            
            # ç”Ÿæˆå„ç§å¯èƒ½çš„v1å€¼ï¼ˆæ­¥é•¿0.1mlï¼‰
            max_steps = int(total_volume * 10) + 1
            
            for i, v1 in enumerate(range(1, max_steps)):
                v1_ml = v1 / 10.0
                v2_ml = (target_gel_mass - c1_actual * v1_ml) / c2_actual
                
                if v2_ml > 0 and (v1_ml + v2_ml) <= total_volume:
                    buffer_vol = total_volume - (v1_ml + v2_ml)
                    actual_concentration = (c1_actual * v1_ml + c2_actual * v2_ml) / total_volume
                    
                    if abs(actual_concentration - target_conc) < 0.001:
                        solutions.append({
                            'volumes': [v1_ml, v2_ml],
                            'buffer_volume': buffer_vol,
                            'actual_conc': actual_concentration,
                            'score': self.calculate_score([v1_ml, v2_ml], buffer_vol, total_volume)
                        })
        
        else:
            # ä¸‰ä¸ªæˆ–æ›´å¤šèƒ¶æµ“åº¦ - ä½¿ç”¨ä¼˜åŒ–æ–¹æ³•
            status_text.text("ğŸ” è®¡ç®—å¤šç§èƒ¶æ··åˆæ–¹æ¡ˆ...")
            solutions = self.solve_multiple_gels(selected_gels, actual_gel_concentrations, target_conc, total_volume)
        
        # æ·»åŠ æœ€å¤§ä½¿ç”¨é‡è§£
        status_text.text("ğŸ” ç”Ÿæˆæœ€å¤§ä½¿ç”¨é‡æ–¹æ¡ˆ...")
        max_usage_solutions = self.find_max_usage_solutions(selected_gels, actual_gel_concentrations, target_conc, total_volume)
        solutions.extend(max_usage_solutions)
        
        # å»é‡å¹¶æ’åº
        status_text.text("ğŸ” æ’åºå’Œç­›é€‰æœ€ä¼˜è§£...")
        unique_solutions = self.remove_duplicate_solutions(solutions)
        unique_solutions.sort(key=lambda x: x['score'], reverse=True)
        
        status_text.empty()
        
        return unique_solutions[:10]
    
    def solve_multiple_gels(self, selected_gels, actual_concentrations, target_conc, total_volume):
        """è§£å†³å¤šä¸ªèƒ¶æµ“åº¦çš„æƒ…å†µ"""
        solutions = []
        n_gels = len(selected_gels)
        target_gel_mass = target_conc * total_volume
        
        # ä½¿ç”¨å›ºå®šæ­¥é•¿æœç´¢
        step = 0.5  # 0.5mlæ­¥é•¿
        max_steps = int(total_volume / step) + 1
        
        # ä¸ºå‰n-1ä¸ªèƒ¶ç”Ÿæˆä½“ç§¯ç»„åˆ
        for volumes in product([i * step for i in range(1, max_steps)], repeat=n_gels-1):
            # ç¡®ä¿æ‰€æœ‰é€‰ä¸­çš„èƒ¶éƒ½è¢«ä½¿ç”¨ï¼ˆä½“ç§¯>0ï¼‰
            if any(v <= 0 for v in volumes):
                continue
            
            total_used_volume = sum(volumes)
            if total_used_volume >= total_volume:
                continue
            
            # è®¡ç®—æœ€åä¸€ä¸ªèƒ¶çš„ä½“ç§¯
            remaining_mass = target_gel_mass - sum(c * v for c, v in zip(actual_concentrations[:-1], volumes))
            last_volume = remaining_mass / actual_concentrations[-1]
            
            if last_volume > 0 and (total_used_volume + last_volume) <= total_volume:
                all_volumes = list(volumes) + [last_volume]
                buffer_vol = total_volume - sum(all_volumes)
                
                # éªŒè¯æµ“åº¦
                actual_concentration = sum(c * v for c, v in zip(actual_concentrations, all_volumes)) / total_volume
                if abs(actual_concentration - target_conc) < 0.001:  # å…è®¸å¾®å°è¯¯å·®
                    solutions.append({
                        'volumes': all_volumes,
                        'buffer_volume': buffer_vol,
                        'actual_conc': actual_concentration,
                        'score': self.calculate_score(all_volumes, buffer_vol, total_volume)
                    })
        
        return solutions
    
    def find_max_usage_solutions(self, selected_gels, actual_concentrations, target_conc, total_volume):
        """æ‰¾åˆ°å„ç§æœ€å¤§ä½¿ç”¨é‡çš„è§£"""
        solutions = []
        n_gels = len(selected_gels)
        target_gel_mass = target_conc * total_volume
        
        # ä¸ºæ¯ç§èƒ¶ç”Ÿæˆä¸€ä¸ªæœ€å¤§ä½¿ç”¨é‡è§£
        for i in range(n_gels):
            # è®©ç¬¬iç§èƒ¶ä½¿ç”¨æœ€å¤§å¯èƒ½é‡ï¼Œå…¶ä»–èƒ¶æŒ‰æ¯”ä¾‹åˆ†é…å‰©ä½™è´¨é‡
            max_volumes = [0.1] * n_gels  # æ‰€æœ‰èƒ¶è‡³å°‘ç”¨0.1ml
            
            # ç¬¬iç§èƒ¶ç”¨è¾ƒå¤§ä½“ç§¯
            max_volumes[i] = total_volume * 0.6  # ç”¨60%çš„æ€»ä½“ç§¯
            
            # è°ƒæ•´å…¶ä»–èƒ¶çš„ä½“ç§¯ä»¥æ»¡è¶³æµ“åº¦è¦æ±‚
            current_mass = sum(c * v for c, v in zip(actual_concentrations, max_volumes))
            
            if current_mass > 0:
                scale_factor = target_gel_mass / current_mass
                
                # æŒ‰æ¯”ä¾‹ç¼©æ”¾æ‰€æœ‰ä½“ç§¯
                scaled_volumes = [v * scale_factor for v in max_volumes]
                total_gel_vol = sum(scaled_volumes)
                
                if total_gel_vol <= total_volume:
                    buffer_vol = total_volume - total_gel_vol
                    actual_concentration = sum(c * v for c, v in zip(actual_concentrations, scaled_volumes)) / total_volume
                    
                    if abs(actual_concentration - target_conc) < 0.001:
                        solutions.append({
                            'volumes': scaled_volumes,
                            'buffer_volume': buffer_vol,
                            'actual_conc': actual_concentration,
                            'score': self.calculate_score(scaled_volumes, buffer_vol, total_volume) - i
                        })
        
        # æ·»åŠ å‡è¡¡ä½¿ç”¨è§£
        if n_gels > 0:
            balanced_volumes = [total_volume * 0.8 / n_gels] * n_gels  # æ¯ç§èƒ¶ç”¨ç›¸ä¼¼ä½“ç§¯
            current_mass = sum(c * v for c, v in zip(actual_concentrations, balanced_volumes))
            
            if current_mass > 0:
                scale_factor = target_gel_mass / current_mass
                scaled_volumes = [v * scale_factor for v in balanced_volumes]
                total_gel_vol = sum(scaled_volumes)
                
                if total_gel_vol <= total_volume:
                    buffer_vol = total_volume - total_gel_vol
                    actual_concentration = sum(c * v for c, v in zip(actual_concentrations, scaled_volumes)) / total_volume
                    
                    if abs(actual_concentration - target_conc) < 0.001:
                        solutions.append({
                            'volumes': scaled_volumes,
                            'buffer_volume': buffer_vol,
                            'actual_conc': actual_concentration,
                            'score': self.calculate_score(scaled_volumes, buffer_vol, total_volume) + 10
                        })
        
        return solutions
    
    def calculate_score(self, volumes, buffer_volume, total_volume):
        """è®¡ç®—è§£çš„è¯„åˆ†ï¼Œæ•´æ•°è§£ä¼˜å…ˆ"""
        score = 0
        
        # æ•´æ•°è§£åŠ åˆ†ï¼ˆä¸»è¦è¯„åˆ†æ ‡å‡†ï¼‰
        if all(abs(v - round(v)) < 0.001 for v in volumes) and abs(buffer_volume - round(buffer_volume)) < 0.001:
            score += 1000  # æ•´æ•°è§£å¤§å¹…åŠ åˆ†
        
        # ä½“ç§¯æ•°å€¼ç®€å•åŠ åˆ†ï¼ˆèƒ½è¢«0.5, 1, 2, 5æ•´é™¤ï¼‰
        for v in volumes:
            if v > 0:
                if v == round(v):  # æ•´æ•°
                    score += 100
                elif v * 2 == round(v * 2):  # 0.5çš„å€æ•°
                    score += 50
                elif v * 10 == round(v * 10):  # 0.1çš„å€æ•°
                    score += 20
        
        if buffer_volume == round(buffer_volume):  # æ•´æ•°ç¼“å†²æ¶²
            score += 50
        
        # ä½¿ç”¨å¤šç§èƒ¶åŠ åˆ†ï¼ˆå¤šæ ·æ€§ï¼‰
        used_gels = sum(1 for v in volumes if v > 0.1)  # å¤§äº0.1mlç®—ä½¿ç”¨
        score += used_gels * 10
        
        # ç¼“å†²æ¶²æ¯”ä¾‹é€‚ä¸­åŠ åˆ†ï¼ˆ10%-90%ï¼‰
        buffer_ratio = buffer_volume / total_volume
        if 0.1 <= buffer_ratio <= 0.9:
            score += 30
        
        # é¿å…æç«¯ä½“ç§¯åŠ åˆ†
        if all(0.1 <= v <= total_volume * 0.8 for v in volumes):
            score += 20
        
        return score
    
    def remove_duplicate_solutions(self, solutions):
        """å»é™¤é‡å¤çš„è§£"""
        unique_solutions = []
        seen = set()
        
        for sol in solutions:
            # åˆ›å»ºè§£çš„æŒ‡çº¹ï¼ˆå››èˆäº”å…¥åˆ°å°æ•°ç‚¹å2ä½ï¼‰
            fingerprint = tuple(round(v, 2) for v in sol['volumes'])
            
            if fingerprint not in seen:
                seen.add(fingerprint)
                unique_solutions.append(sol)
        
        return unique_solutions
    
    def display_results(self, solutions, selected_gels, total_volume, target_conc):
        if not solutions:
            st.warning("âš ï¸ æ— æ³•æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„é…æ¯”æ–¹æ¡ˆï¼Œè¯·å°è¯•è°ƒæ•´å‚æ•°æˆ–é€‰æ‹©ä¸åŒçš„èƒ¶æµ“åº¦")
            return
        
        # æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        st.success(f"âœ… æ‰¾åˆ° {len(solutions)} ä¸ªæœ‰æ•ˆæ–¹æ¡ˆ")
        
        integer_solutions = sum(1 for sol in solutions if all(abs(v - round(v)) < 0.001 for v in sol['volumes']))
        
        cols = st.columns(3)
        with cols[0]:
            st.metric("æ€»æ–¹æ¡ˆæ•°", len(solutions))
        with cols[1]:
            st.metric("æ•´æ•°è§£", integer_solutions)
        with cols[2]:
            best_score = max(sol['score'] for sol in solutions) if solutions else 0
            st.metric("æœ€é«˜è¯„åˆ†", f"{best_score:.0f}")
        
        st.divider()
        
        # æ˜¾ç¤ºå‰10ä¸ªæ–¹æ¡ˆ
        st.subheader(f"ğŸ“Š å‰{min(len(solutions), 10)}ä¸ªæœ€ä¼˜æ–¹æ¡ˆ")
        
        for i, sol in enumerate(solutions[:10], 1):
            # åˆ›å»ºå¡ç‰‡å¼å±•ç¤º
            with st.container():
                # æ ‡é¢˜è¡Œ
                is_integer = all(abs(v - round(v)) < 0.001 for v in sol['volumes'])
                solution_type = "ğŸ”¢ æ•´æ•°è§£" if is_integer else "ğŸ“ å°æ•°è§£"
                
                cols = st.columns([3, 1])
                with cols[0]:
                    st.markdown(f"### æ–¹æ¡ˆ {i} â€¢ {solution_type} â€¢ è¯„åˆ†: {sol['score']:.0f}")
                with cols[1]:
                    buffer_ratio = sol['buffer_volume'] / total_volume * 100
                    st.metric("ç¼“å†²æ¶²æ¯”ä¾‹", f"{buffer_ratio:.1f}%")
                
                # è¯¦ç»†é…æ¯”
                st.markdown("**é…æ¯”æ–¹æ¡ˆ:**")
                
                # ä½¿ç”¨åˆ—æ˜¾ç¤ºèƒ¶ç”¨é‡
                gel_cols = st.columns(len(selected_gels) + 2)
                
                for j, (gel_conc, vol) in enumerate(zip(selected_gels, sol['volumes'])):
                    with gel_cols[j]:
                        st.metric(
                            label=f"{gel_conc}%èƒ¶",
                            value=f"{vol:.2f}ml",
                            delta=f"{(vol/total_volume*100):.1f}%" if total_volume > 0 else "0%"
                        )
                
                # ç¼“å†²æ¶²ç”¨é‡
                with gel_cols[-2]:
                    st.metric(
                        label="ç¼“å†²æ¶²",
                        value=f"{sol['buffer_volume']:.2f}ml",
                        delta=f"{(sol['buffer_volume']/total_volume*100):.1f}%"
                    )
                
                # å®é™…æµ“åº¦
                with gel_cols[-1]:
                    st.metric(
                        label="å®é™…æµ“åº¦",
                        value=f"{sol['actual_conc']:.3f}%",
                        delta=f"åå·®: {abs(sol['actual_conc']-target_conc):.3f}%"
                    )
                
                # æ“ä½œå»ºè®®
                if i == 1 and is_integer:
                    st.success("ğŸ¯ **æ¨èä½¿ç”¨æ­¤æ–¹æ¡ˆ** - æ•´æ•°è§£ï¼Œæ“ä½œæœ€æ–¹ä¾¿")
                elif i == 1:
                    st.info("ğŸ’¡ **å»ºè®®æ–¹æ¡ˆ** - è¯„åˆ†æœ€é«˜ï¼Œä½†åŒ…å«å°æ•°")
                
                # åˆ†éš”çº¿ï¼ˆæœ€åä¸€ä¸ªæ–¹æ¡ˆä¸æ˜¾ç¤ºï¼‰
                if i < min(len(solutions), 10):
                    st.divider()

def main():
    # è®¾ç½®é¡µé¢é…ç½®
    st.set_page_config(
        page_title="WBèƒ¶æµ“åº¦ç¨€é‡Šè®¡ç®—å™¨",
        page_icon="ğŸ§ª",
        layout="wide",
        initial_sidebar_state="expanded"
    )
    
    # åˆ›å»ºä¾§è¾¹æ 
    with st.sidebar:
        st.image("https://img.icons8.com/color/96/000000/test-tube.png", width=80)
        st.title("WBèƒ¶è®¡ç®—å™¨")
        
        st.markdown("---")
        
        st.markdown("""
        **åŠŸèƒ½ç‰¹æ€§ï¼š**
        
        ğŸ¯ å¤šèƒ¶æ··åˆè®¡ç®—
        ğŸ“Š æ•´æ•°è§£ä¼˜å…ˆ
        âš¡ å®æ—¶è®¡ç®—
        ğŸ“± å“åº”å¼è®¾è®¡
        
        **è®¡ç®—åŸç†ï¼š**
        
        1. å¸‚å”®èƒ¶å®é™…æµ“åº¦ = æ ‡ç­¾æµ“åº¦ Ã— 2
        2. ç›®æ ‡èƒ¶è´¨é‡ = ç›®æ ‡æµ“åº¦ Ã— æ€»ä½“ç§¯
        3. è‡ªåŠ¨æœç´¢æœ€ä¼˜ä½“ç§¯é…æ¯”
        
        **è¯„åˆ†æ ‡å‡†ï¼š**
        
        - æ•´æ•°è§£: +1000åˆ†
        - ç®€å•æ•°å€¼: +50-100åˆ†
        - ç¼“å†²æ¶²æ¯”ä¾‹é€‚ä¸­: +30åˆ†
        - ä½¿ç”¨å¤šç§èƒ¶: +10åˆ†/ç§
        """)
        
        st.markdown("---")
        
        st.caption("ç‰ˆæœ¬ 2.0 | åŸºäºStreamlité‡æ„")
        st.caption("Â© 2023 WBèƒ¶è®¡ç®—å™¨ | ä»…ä¾›ç§‘ç ”ä½¿ç”¨")
    
    # åˆ›å»ºè®¡ç®—å™¨å®ä¾‹å¹¶è¿è¡Œ
    try:
        calculator = WBGelCalculator()
        calculator.setup_ui()
    except Exception as e:
        st.error(f"åº”ç”¨ç¨‹åºé”™è¯¯: {str(e)}")
        st.info("è¯·åˆ·æ–°é¡µé¢é‡è¯•")

if __name__ == "__main__":
    main()
